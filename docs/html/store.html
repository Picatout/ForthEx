<DOCTYPE! html>
<html lang="fr-CA">
<head>
 <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
 <link rel="stylesheet" type="text/css" href="css/forthex.css"></head>
<body id="#top">
<h1>store</h1><div><a href="#index">index</a></div>
<div><a href="index.html#MasterIndex">index principal</a></div>
<h2 id="description">Description</h2><div>  
</div>
<div> Interface de base avec les m√©moire externe RAM SPI et EEPROM SPI.
</div>
<div> Le stockage se fait par bloc de 1024 octets.
</div>
<div> Le terme XRAM r√©f√®re √† la m√©moire RAM SPI.
</div>
<div><a href="index.html#MasterIndex">index principal</a></div>
<hr style="border-width:4px;"><h2 id="description">Description</h2><div>
</div>
<div>  La RAM SPI 23LC1024 a une capacit√©e de 128Ko.    
</div>
<div><a href="index.html#MasterIndex">index principal</a></div>
<hr style="border-width:4px;"><p id="XBLK&gt;ADR">
<b>XBLK&gt;ADR</b> ; ( u -- ud )
<div>   Convertie un num√©ro de bloc XRAM en adresse absolue XRAM.    
</div>
</p>
<div><b> arguments:
</b></div>
<div><i>u</i>&nbsp;&nbsp;  Entier simple non sign√©, num√©ro du bloc, {1..MAX_BLOCK}
</div>
<div><b> retourne:
</b></div>
<div><i>ud</i>&nbsp;&nbsp; Entier double non sign√©, adresse d√©but bloc dans la RAM SPI.
</div>
<div><a href="#index">index</a></div>
<div><a href="#top">haut</a></div>
<div><a href="index.html#MasterIndex">index principal</a></div>
<hr style="border-width:1px;"><p id="XWRITE">
<b>XWRITE</b> ( u1 n+ ud1 -- )
<div>   Transfert un bloc d'octets de la RAM du MCU vers la RAM SPI.
</div>
</p>
<div><b> arguments: 
</b></div>
<div><i>u1</i>&nbsp;&nbsp; Adresse d√©but bloc RAM.
</div>
<div><i>n+</i>&nbsp;&nbsp; Nombre d'octets √† transf√©rer.
</div>
<div><i>ud1</i>&nbsp;&nbsp; Entier double non sign√©, Adresse destination dans la RAM SPI. 
</div>
<div><b> retourne:    
</b></div>
<div><i>rien
</i>&nbsp;&nbsp;</div>
<div><a href="#index">index</a></div>
<div><a href="#top">haut</a></div>
<div><a href="index.html#MasterIndex">index principal</a></div>
<hr style="border-width:1px;"><p id="XREAD">
<b>XREAD</b>  ( u1 n+ ud1 -- )
<div>   Transfert un bloc d'octets de la RAM SPI vers la RAM du MCU.
</div>
</p>
<div><b> arguments: 
</b></div>
<div><i>u1</i>&nbsp;&nbsp;  Entier simple non sign√©, adresse d√©but tampon RAM.
</div>
<div><i>n+</i>&nbsp;&nbsp;  Entier simple positif, Nombre d'octets √† transf√©r√©er.
</div>
<div><i>ud1</i>&nbsp;&nbsp; Entier double non sign√©, adresse d√©but du bloc dans la RAM SPI.
</div>
<div><b> retourne:    
</b></div>
<div><i>rien
</i>&nbsp;&nbsp;</div>
<div><a href="#index">index</a></div>
<div><a href="#top">haut</a></div>
<div><a href="index.html#MasterIndex">index principal</a></div>
<hr style="border-width:1px;"><p id="XBLKCOUNT">
<b>XBLKCOUNT</b>  ( -- n )
<div>   Constante, capacit√© en nombre de blocs de la RAM SPI.    
</div>
</p>
<div><b> arguments:
</b></div>
<div><i>aucun
</i>&nbsp;&nbsp;</div>
<div><b> retourne:
</b></div>
<div><i>n</i>&nbsp;&nbsp;   Capacit√© en nombre de blocs de la RAM SPI.    
</div>
<div><a href="#index">index</a></div>
<div><a href="#top">haut</a></div>
<div><a href="index.html#MasterIndex">index principal</a></div>
<hr style="border-width:1px;"><p id="XBOUND">
<b>XBOUND</b>  ( n+ -- f )
<div>   V√©rifie si le num√©ro de bloc est dans les limites
</div>
</p>
<div><b> arguments:
</b></div>
<div><i>n+</i>&nbsp;&nbsp;   Num√©ro du bloc √† v√©rifier.
</div>
<div><b> retourne:
</b></div>
<div><i>f</i>&nbsp;&nbsp;   Indicateur bool√©en, vrai si le num√©ro de bloc est valide.
</div>
<div><a href="#index">index</a></div>
<div><a href="#top">haut</a></div>
<div><a href="index.html#MasterIndex">index principal</a></div>
<hr style="border-width:1px;"><h2 id="description">Description</h2><div>
</div>
<div>   l'EEPROM 25LC1024 a une capacit√© de 128Ko et est divis√©e en 
</div>
<div>   512 rang√©es de 256 octets pour la commande EWRITE.
</div>
<div>   Il est possible de mette √† jour 1 seul octet mais
</div>
<div>   on ne peut √©crire qu'un maximum de 
</div>
<div>   256 octets par commande EWRITE.    
</div>
<div><a href="index.html#MasterIndex">index principal</a></div>
<hr style="border-width:4px;"><p id="?WIP">
<b>?WIP</b>  ( -- f )    
<div>   Test le bit WRITE IN PROCESS de l'EEPROM et retourne son √©tat.
</div>
</p>
<div><b> arguments:
</b></div>
<div><i>aucun
</i>&nbsp;&nbsp;</div>
<div><b> retourne:
</b></div>
<div><i>f</i>&nbsp;&nbsp;   Indicateur Bool√©en, VRAI si une op√©ration d'√©criture est en cour.    
</div>
<div><a href="#index">index</a></div>
<div><a href="#top">haut</a></div>
<div><a href="index.html#MasterIndex">index principal</a></div>
<hr style="border-width:1px;"><p id="WWIP">
<b>WWIP</b>   ( -- )    
<div>   Attend que l'op√©ration d'√©criture de l'EEPROM soit compl√©t√©e.
</div>
</p>
<div><b> arguments:
</b></div>
<div><i>aucun
</i>&nbsp;&nbsp;</div>
<div><b> retourne:
</b></div>
<div><i>rien</i>&nbsp;&nbsp;    
</div>
<div><a href="#index">index</a></div>
<div><a href="#top">haut</a></div>
<div><a href="index.html#MasterIndex">index principal</a></div>
<hr style="border-width:1px;"><p id="EEBLK&gt;ADR">
<b>EEBLK&gt;ADR</b>  ( u -- ud )
<div>   Convertie un num√©ro de bloc en adresse EEPROM
</div>
</p>
<div><b> arguments:
</b></div>
<div><i>u</i>&nbsp;&nbsp; Entier simple non sign√©, num√©ro du block {1..MAX_BLOCK}
</div>
<div><b> retourne:
</b></div>
<div><i>ud</i>&nbsp;&nbsp; Entier double non sign√©, adresse d√©but bloc dans l'EEPROM
</div>
<div><a href="#index">index</a></div>
<div><a href="#top">haut</a></div>
<div><a href="index.html#MasterIndex">index principal</a></div>
<hr style="border-width:1px;"><p id="RAM&gt;EE">
<b>RAM&gt;EE</b> ( u1 n+ ud1 -- )
<div>   Enregistrement d'une plage RAM dans l'EEPROM
</div>
<div> IMPORTANT:
</div>
<div>     la m√©moire EEPROM est divis√©e en
</div>
<div>     rang√©es de 256 octets. Lorsque le pointeur
</div>
<div>     d'adresse atteint la fin d'une rang√©e il 
</div>
<div>     revient au d√©but de celle-ci. Donc si 'ud1'
</div>
<div>     pointe le d√©but de la rang√©e un maximum de 256
</div>
<div>     octets peuvent-√™tre √©cris avant l'√©crasement
</div>
<div>     des premiers octets. 
</div>
</p>
<div><b> arguments: 
</b></div>
<div><i>u1</i>&nbsp;&nbsp; Entier simple, adresse 16 bits d√©but bloc RAM
</div>
<div><i>n+</i>&nbsp;&nbsp; Entier simple positif, nombre d'octets √† enregistrer {1..256} 
</div>
<div><i>ud2</i>&nbsp;&nbsp; Entier double non sign√©, adresse destination dans l'EEPROM
</div>
<div><b> retourne: 
</b></div>
<div><i>rien
</i>&nbsp;&nbsp;</div>
<div><a href="#index">index</a></div>
<div><a href="#top">haut</a></div>
<div><a href="index.html#MasterIndex">index principal</a></div>
<hr style="border-width:1px;"><p id="EEREAD">
<b>EEREAD</b>   ( u1 n+ ud -- )
<div>   Copie d'une plage EEPROM vers la m√©moire RAM.
</div>
</p>
<div><b> arguments:
</b></div>
<div><i>u1</i>&nbsp;&nbsp; Entier simple non sign√©, adresse 16 bits d√©but RAM.
</div>
<div><i>n+</i>&nbsp;&nbsp; Entier simple positif, nombre d'octets √† copier. 
</div>
<div><i>ud</i>&nbsp;&nbsp; Entier double non sign√©, adresse source dans l'EEPROM.
</div>
<div><b> retourne:
</b></div>
<div><i>rien</i>&nbsp;&nbsp;    
</div>
<div><a href="#index">index</a></div>
<div><a href="#top">haut</a></div>
<div><a href="index.html#MasterIndex">index principal</a></div>
<hr style="border-width:1px;"><p id="EPAGE">
<b>EPAGE</b>  ( -- n )
<div>   Valeur constante indiquant qu'il s'agit d'une op√©ration d'effacement d'une page.
</div>
<div>   L'EEPROM peut-√™tre effac√©e par page,secteur ou au complet. 
</div>
</p>
<div><b> arguments:
</b></div>
<div><i>aucun
</i>&nbsp;&nbsp;</div>
<div><b> retourne:
</b></div>
<div><i>n</i>&nbsp;&nbsp;     Consteante idenfiant cette op√©ration.    
</div>
<div><a href="#index">index</a></div>
<div><a href="#top">haut</a></div>
<div><a href="index.html#MasterIndex">index principal</a></div>
<hr style="border-width:1px;"><p id="ESECTOR">
<b>ESECTOR</b>  ( -- n )
<div>   Valeur constante indiquant qu'il s'agit d'une op√©ration d'effacement d'un secteur.
</div>
<div>   L'EEPROM peut-√™tre effac√©e par page,secteur ou au complet. 
</div>
</p>
<div><b> arguments:
</b></div>
<div><i>aucun
</i>&nbsp;&nbsp;</div>
<div><b> retourne:
</b></div>
<div><i>n</i>&nbsp;&nbsp;     Constante idenfiant cette op√©ration.    
</div>
<div><a href="#index">index</a></div>
<div><a href="#top">haut</a></div>
<div><a href="index.html#MasterIndex">index principal</a></div>
<hr style="border-width:1px;"><p id="EALL">
<b>EALL</b>  ( -- n )
<div>   Valeur constante indiquant qu'il s'agit d'une op√©ration d'effacement complet.
</div>
<div>   Toute l'EEPROM sera effac√©e.    
</div>
</p>
<div><b> arguments:
</b></div>
<div><i>aucun
</i>&nbsp;&nbsp;</div>
<div><b> retourne:
</b></div>
<div><i>n</i>&nbsp;&nbsp;     Consteante idenfiant cette op√©ration.    
</div>
<div><a href="#index">index</a></div>
<div><a href="#top">haut</a></div>
<div><a href="index.html#MasterIndex">index principal</a></div>
<hr style="border-width:1px;"><p id="EERASE">
<b>EERASE</b> ( EALL | n {EPAGE|ESECTOR} -- )    
<div>   Efface une page, 1 secteur ou l'EEPROM au complet.
</div>
<div>   l'argument 'n' est requis que pour les op√©rations EPAGE ou ESECTOR.    
</div>
</p>
<div><b> arguments:
</b></div>
<div><i>'n'</i>&nbsp;&nbsp; Num√©ro de page {0..511} ou de secteur {0..3}
</div>
<div><i>'op'</i>&nbsp;&nbsp; Op√©ration: {EPAGE|ESECTOR|EALL}
</div>
<div><b> retourne:
</b></div>
<div><i>rien</i>&nbsp;&nbsp;    
</div>
<div><a href="#index">index</a></div>
<div><a href="#top">haut</a></div>
<div><a href="index.html#MasterIndex">index principal</a></div>
<hr style="border-width:1px;"><p id="EEWRITE">
<b>EEWRITE</b>  ( u1 ud -- )    
<div>   √âcriture d'un bloc RAM dans l'EEPROM externe.
</div>
<div>   L'√©criture se fait par segment de 256 octets. 
</div>
<div>   Un bloc compte 1024 octets.    
</div>
</p>
<div><b> arguments:
</b></div>
<div><i>u1</i>&nbsp;&nbsp; Entier simple non sign√©, adresse RAM d√©but du bloc.
</div>
<div><i>ud</i>&nbsp;&nbsp; Entier double non sign√©, adresse d√©but dans l'EEPROM.
</div>
<div><b> retourne:
</b></div>
<div><i>rien</i>&nbsp;&nbsp;    
</div>
<div><a href="#index">index</a></div>
<div><a href="#top">haut</a></div>
<div><a href="index.html#MasterIndex">index principal</a></div>
<hr style="border-width:1px;"><p id="EEBLKCOUNT">
<b>EEBLKCOUNT</b>  ( -- n )  
<div>   Constante, capacit√© en nombre de blocs de l'EEPROM.
</div>
</p>
<div><b> arguments:
</b></div>
<div><i>aucun
</i>&nbsp;&nbsp;</div>
<div><b> retourne:
</b></div>
<div><i>n</i>&nbsp;&nbsp;  Capacit√© en nombre de blocs.  
</div>
<div><a href="#index">index</a></div>
<div><a href="#top">haut</a></div>
<div><a href="index.html#MasterIndex">index principal</a></div>
<hr style="border-width:1px;"><p id="EEBOUND">
<b>EEBOUND</b>  ( n+ -- f )
<div>   V√©rifie si le num√©ro de bloc est dans les limites de validit√©.
</div>
</p>
<div><b> arguments:
</b></div>
<div><i>n+</i>&nbsp;&nbsp; Num√©ro du bloc √† v√©rifier.
</div>
<div><b> retourne:
</b></div>
<div><i>f</i>&nbsp;&nbsp;  Indicateur bool√©en, vrai si le num√©ro de bloc est valide.
</div>
<div><a href="#index">index</a></div>
<div><a href="#top">haut</a></div>
<div><a href="index.html#MasterIndex">index principal</a></div>
<hr style="border-width:1px;"><h2 id="description">Description</h2><div>
</div>
<div> Les p√©riph√©riques de stockage sont d√©finis par une table contenant
</div>
<div> les CFA des fonctions de bases.  
</div>
<div>  <br><table border="single">
</div>
<div>  <tr><th>nom</th><th>description</th></tr>  
</div>
<div>  <tr><td>DEVID</td><td>Identifiant du pÈriphÈrique.</td></tr>  
</div>
<div>  <tr><td>READ</td><td>CFA de la fonction de lecture d'un bloc.</td></tr>
</div>
<div>  <tr><td>WRITE</td><td>CFA de la fonction d'Ècriture d'un bloc.</td></tr>
</div>
<div>  <tr><td>BLK&gt;ADR</td><td>CFA de la fonction de conversion numÈro de bloc en adresse.</td></tr>
</div>
<div>  <tr><td>BOUND</td><td>CFA de la fonction qui valide le numÈro de bloc.</td></tr>
</div>
<div>  </table><br>
</div>
<div> Il y a 3 p√©riph√©riques de stockage, XRAM, EEPROM et SDCARD.
</div>
<div><a href="index.html#MasterIndex">index principal</a></div>
<hr style="border-width:4px;"><p id="DEVID">
<b>DEVID</b>  ( -- n )
<div>   Constante, accesseur du champ identifiant le p√©riph√©rique, dans la structure
</div>
<div>   descripteur de p√©riph√©rique bloc.
</div>
</p>
<div><b> arguments:
</b></div>
<div><i>aucun
</i>&nbsp;&nbsp;</div>
<div><b> retourne:
</b></div>
<div><i>n</i>&nbsp;&nbsp;  Index du champ dans la table.  
</div>
<div><a href="#index">index</a></div>
<div><a href="#top">haut</a></div>
<div><a href="index.html#MasterIndex">index principal</a></div>
<hr style="border-width:1px;"><p id="FN_READ">
<b>FN_READ</b>  ( -- n )
<div>   Constante, accesseur de champ dans la structure descripteur de p√©riph√©rique bloc.
</div>
<div>   Ce champ acc√®de la fonction READ qui effectue la lecture d'un bloc sur le p√©riph√©rique. 
</div>
</p>
<div><b> arguments:
</b></div>
<div><i>aucun
</i>&nbsp;&nbsp;</div>
<div><b> retourne:
</b></div>
<div><i>n</i>&nbsp;&nbsp;   Index du champ dans la table.  
</div>
<div><a href="#index">index</a></div>
<div><a href="#top">haut</a></div>
<div><a href="index.html#MasterIndex">index principal</a></div>
<hr style="border-width:1px;"><p id="FN_WRITE">
<b>FN_WRITE</b>  ( -- n )
<div>   Constante, accesseur de champ dans la structure descripteur de p√©riph√©rique bloc.
</div>
<div>   Ce champ acc√®de la fonction WRITE qui √©cris un bloc sur p√©riph√©rique.
</div>
</p>
<div><b> arguments:
</b></div>
<div><i>aucun
</i>&nbsp;&nbsp;</div>
<div><b> retourne:
</b></div>
<div><i>n</i>&nbsp;&nbsp;    Index du champ dans la table.  
</div>
<div><a href="#index">index</a></div>
<div><a href="#top">haut</a></div>
<div><a href="index.html#MasterIndex">index principal</a></div>
<hr style="border-width:1px;"><p id="FN_BLK&gt;ADR">
<b>FN_BLK&gt;ADR</b>  ( -- n )
<div>   Constante, accesseur de champ dans la structure descripteur de p√©riph√©rique bloc.
</div>
<div>   Ce champ acc√®de la fonction BLK&gt;ADR  qui convertie un num√©ro de bloc en adressse absolue. 
</div>
</p>
<div><b> arguments:
</b></div>
<div><i>aucun
</i>&nbsp;&nbsp;</div>
<div><b> retourne:
</b></div>
<div><i>n</i>&nbsp;&nbsp;    Index du champ dans la table.  
</div>
<div><a href="#index">index</a></div>
<div><a href="#top">haut</a></div>
<div><a href="index.html#MasterIndex">index principal</a></div>
<hr style="border-width:1px;"><p id="FN_BOUND">
<b>FN_BOUND</b>  ( -- n )
<div>   Constante, accesseur de champ dans la structure descripteur de p√©riph√©rique bloc.
</div>
<div>   Ce champ acc√®de la fonction BOUND  qui v√©rifie la validit√© d'un no. de bloc.
</div>
</p>
<div><b> arguments:
</b></div>
<div><i>aucun
</i>&nbsp;&nbsp;</div>
<div><b> retourne:
</b></div>
<div><i>n</i>&nbsp;&nbsp;    Index du champ dans la structure.  
</div>
<div><a href="#index">index</a></div>
<div><a href="#top">haut</a></div>
<div><a href="index.html#MasterIndex">index principal</a></div>
<hr style="border-width:1px;"><p id="XRAM">
<b>XRAM</b>   ( -- a-addr )  
<div>   Retourne l'adresse du descripteur du p√©riph√©rique RAM SPI.    
</div>
</p>
<div><b> arguments:
</b></div>
<div><i>aucun
</i>&nbsp;&nbsp;</div>
<div><b> retourne:
</b></div>
<div><i>a-addr</i>&nbsp;&nbsp;   Adresse du descripteur de p√©riph√©rique.  
</div>
<div><a href="#index">index</a></div>
<div><a href="#top">haut</a></div>
<div><a href="index.html#MasterIndex">index principal</a></div>
<hr style="border-width:1px;"><p id="EEPROM">
<b>EEPROM</b>   ( -- a-addr )  
<div>   Retourne l'adresse du descripteur du p√©riph√©rique EEPROM.    
</div>
</p>
<div><b> arguments:
</b></div>
<div><i>aucun
</i>&nbsp;&nbsp;</div>
<div><b> retourne:
</b></div>
<div><i>a-addr</i>&nbsp;&nbsp;   Adresse du descripteur de p√©riph√©rique.  
</div>
<div><a href="#index">index</a></div>
<div><a href="#top">haut</a></div>
<div><a href="index.html#MasterIndex">index principal</a></div>
<hr style="border-width:1px;"><h4 id="index">Index</h4>
<p>
<ul>
<li><a href="#?WIP">?WIP</a></li>
<li><a href="#DEVID">DEVID</a></li>
<li><a href="#EALL">EALL</a></li>
<li><a href="#EEBLK&gt;ADR">EEBLK&gt;ADR</a></li>
<li><a href="#EEBLKCOUNT">EEBLKCOUNT</a></li>
<li><a href="#EEBOUND">EEBOUND</a></li>
<li><a href="#EEPROM">EEPROM</a></li>
<li><a href="#EERASE">EERASE</a></li>
<li><a href="#EEREAD">EEREAD</a></li>
<li><a href="#EEWRITE">EEWRITE</a></li>
<li><a href="#EPAGE">EPAGE</a></li>
<li><a href="#ESECTOR">ESECTOR</a></li>
<li><a href="#FN_BLK&gt;ADR">FN_BLK&gt;ADR</a></li>
<li><a href="#FN_BOUND">FN_BOUND</a></li>
<li><a href="#FN_READ">FN_READ</a></li>
<li><a href="#FN_WRITE">FN_WRITE</a></li>
<li><a href="#RAM&gt;EE">RAM&gt;EE</a></li>
<li><a href="#WWIP">WWIP</a></li>
<li><a href="#XBLK&gt;ADR">XBLK&gt;ADR</a></li>
<li><a href="#XBLKCOUNT">XBLKCOUNT</a></li>
<li><a href="#XBOUND">XBOUND</a></li>
<li><a href="#XRAM">XRAM</a></li>
<li><a href="#XREAD">XREAD</a></li>
<li><a href="#XWRITE">XWRITE</a></li>
</ul>
</p>
<hr style="border-width:1px;"><div><a href="#top">haut</a></div>
<div><a href="index.html#MasterIndex">index principal</a></div>

</body>
</html>
